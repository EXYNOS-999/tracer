Setting up Synapse
Once you have installed synapse as above, you will need to configure it.

TLS certificates
The default configuration exposes a single HTTP port on the local interface: http://localhost:8008. It is suitable for local testing, but for any practical use, you will need Synapse's APIs to be served over HTTPS.

The recommended way to do so is to set up a reverse proxy on port 8448. You can find documentation on doing so in docs/reverse_proxy.md.

Alternatively, you can configure Synapse to expose an HTTPS port. To do so, you will need to edit homeserver.yaml, as follows:

First, under the listeners section, uncomment the configuration for the TLS-enabled listener. (Remove the hash sign (#) at the start of each line). The relevant lines are like this:

  - port: 8448
    type: http
    tls: true
    resources:
      - names: [client, federation]
You will also need to uncomment the tls_certificate_path and tls_private_key_path lines under the TLS section. You can either point these settings at an existing certificate and key, or you can enable Synapse's built-in ACME (Let's Encrypt) support. Instructions for having Synapse automatically provision and renew federation certificates through ACME can be found at ACME.md. Note that, as pointed out in that document, this feature will not work with installs set up after November 2019.

If you are using your own certificate, be sure to use a .pem file that includes the full certificate chain including any intermediate certificates (for instance, if using certbot, use fullchain.pem as your certificate, not cert.pem).

For a more detailed guide to configuring your server for federation, see federate.md.

Email
It is desirable for Synapse to have the capability to send email. This allows Synapse to send password reset emails, send verifications when an email address is added to a user's account, and send email notifications to users when they receive new messages.

To configure an SMTP server for Synapse, modify the configuration section headed email, and be sure to have at least the smtp_host, smtp_port and notif_from fields filled out. You may also need to set smtp_user, smtp_pass, and require_transport_security.

If email is not configured, password reset, registration and notifications via email will be disabled.

Registering a user
The easiest way to create a new user is to do so from a client like Riot.

Alternatively you can do so from the command line if you have installed via pip.

This can be done as follows:

$ source ~/synapse/env/bin/activate
$ synctl start # if not already running
$ register_new_matrix_user -c homeserver.yaml http://localhost:8008
New user localpart: erikj
Password:
Confirm password:
Make admin [no]:
Success!
This process uses a setting registration_shared_secret in homeserver.yaml, which is shared between Synapse itself and the register_new_matrix_user script. It doesn't matter what it is (a random value is generated by --generate-config), but it should be kept secret, as anyone with knowledge of it can register users, including admin accounts, on your server even if enable_registration is false.

Setting up a TURN server
For reliable VoIP calls to be routed via this homeserver, you MUST configure a TURN server. See docs/turn-howto.md for details.

URL previews
Synapse includes support for previewing URLs, which is disabled by default. To turn it on you must enable the url_preview_enabled: True config parameter and explicitly specify the IP ranges that Synapse is not allowed to spider for previewing in the url_preview_ip_range_blacklist configuration parameter. This is critical from a security perspective to stop arbitrary Matrix users spidering 'internal' URLs on your network. At the very least we recommend that your loopback and RFC1918 IP addresses are blacklisted.

This also requires the optional lxml and netaddr python dependencies to be installed. This in turn requires the libxml2 library to be available - on Debian/Ubuntu this means apt-get install libxml2-dev, or equivalent for your OS.